<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<title>Todo List</title>
	<link th:href="@{/css/style.css}" rel="stylesheet" type="text/css">
	<style>
	</style>
</head>

<body>
	<!--„É°„ÉÉ„Çª„Éº„Ç∏ÊåøÂÖ•  -->
	<div th:replace="~{fragments::msg_area}"></div>
	<!-- „É≠„Ç∞„Ç¢„Ç¶„Éà„É™„É≥„ÇØ(9/25ËøΩÂä†) -->
	<a th:href="@{/logout}" th:text="#{text.logout}"></a>
	<h1>Êñ∞Ë¶èÁôªÈå≤„Éï„Ç©„Éº„É†</h1>
	<!-- todoData„ÅÆ„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà„Çí‰ΩøÁî®„Åô„Çã„Å®th:object„ÅßÂÆ£Ë®Ä„ÄÇ„ÅÇ„Å®„ÅØ„ÄÅvalue„ÇÑfield„Åß„Éó„É≠„Éë„ÉÜ„Ç£„ÇíÈÅ∏Êäû„Åô„Çã„ÄÄ„ÅÇ„Åè„Åæ„Åß„ÄÅtymleaf„Åß„Ç®„É©„ÉºË°®Á§∫„ÅÆ„Åü„ÇÅ„ÅÆdiv„ÇØ„É©„Çπ„Åå‰∏ã‰Ωç„ÇØ„É©„Çπ„Å®„Åó„Å¶Â≠òÂú®„Åô„Çã„Åü„ÇÅObjectÊñπ„Çí‰ΩøÁî®„Åß„Åç„Çã„ÄÇ -->
	<!--fieldË¶ÅÁ¥†Ôºùid,name,value  „É°„É¢„Å´Ë©≥Á¥∞„ÇíÊÆã„Åó„Å¶„ÅÑ„Çã  -->
	<!-- fields.hasErrors„ÅßÈ£õ„Å∞„Åó„ÅüÂÜÖÂÆπ„Çíth:errors„Åß„Åù„Çå„Åû„Çå„ÅÆ„Éó„É≠„Éë„ÉÜ„Ç£ÊØé„Å´Âèó„ÅëÂèñ„Çå„Çã„Çà„ÅÜ„Å´Ë®≠ÂÆö -->
	<form th:action="@{/}" method="post" th:object="${todoData}">
		<div style="display: flex">
			<div>
				üî≤Todo
				<table border="1">
					<tr>
						<!-- IdË¶ÅÁ¥†„ÇíËøΩÂä†Ôºà9/1Ôºâ -->
						<th>id</th>
						<td><span th:text="*{id}"></span> <!-- ÁôªÈå≤„ÉªÊõ¥Êñ∞„ÅÆ„Å©„Å°„Çâ„ÅãÂà§Êñ≠„Åô„ÇãÁî®„ÄÇ --> <input type="hidden"
								th:field="*{id}"> <input type="hidden" th:field="*{ownerId}"></td>
					</tr>
					<!--„Ç´„ÉÜ„Ç¥„É™ËøΩÂä†Ôºà11/8Ôºâ -->
					<tr>
						<th th:text="#{label.category}"></th>
						<td>
							<select name="categoryCode">
								<option th:each="c:${session.categoryList}" th:value="${c.pkey.code}"
									th:text="${c.name}" th:selected="${c.pkey.code}==*{categoryCode}"></option>
								<!--Category„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà„ÅÆPkey„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà„ÅÆ‰∏≠„ÅÆcode„ÇíÈÅ∏Êäû„Åß„Åç„Çã„Çà„ÅÜ„Å´Ë™øÊï¥ -->
							</select>
							<div th:if="${#fields.hasErrors('categoryCode')}" th:errors="*{categoryCode}"
								th:errorclass="red"></div>
						</td>
					</tr>
					<tr>
						<!-- È†ÖÁõÆÊØé„Å´„Ç®„É©„Éº„Åå„ÅÇ„Çå„Å∞Ë°®Á§∫„Åô„Çã„Çà„ÅÜ„Å´ÊÆã„Åô-->

						<th>‰ª∂Âêç</th>
						<td><input type="text" name="title" size="40" th:value="*{title}">
							<div th:if="${#fields.hasErrors('title')}" th:errors="*{title}" th:errorclass="red"></div>
						</td>
					</tr>
					<tr>
						<th>ÈáçË¶ÅÂ∫¶</th>
						<td><input type="radio" value="1" th:field="*{importance}">È´ò„ÅÑ
							<input type="radio" value="0" th:field="*{importance}">‰Ωé„ÅÑ
							<div th:if="${#fields.hasErrors('importance')}" th:errors="*{importance}"
								th:errorclass="red"></div>
						</td>
					</tr>

					<tr>
						<th>Á∑äÊÄ•Â∫¶</th>
						<td><select name="urgency">
								<option value="-1" th:field="*{urgency}" th:text="#{option.none}">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
								<option value="1" th:field="*{urgency}" th:text="#{option.high}">È´ò</option>
								<option value="0" th:field="*{urgency}" th:text="#{option.low}">‰Ωé</option>
							</select>
							<div th:if="${#fields.hasErrors('urgency')}" th:errors="*{urgency}" th:errorclass="red">
							</div>
						</td>
					</tr>
					<tr>
						<th>ÊúüÈôê</th>
						<td><input type="text" name="deadline" th:value="*{deadline}" placeholder="yyyy-mm-dd">
							<div th:if="${#fields.hasErrors('deadline')}" th:errors="*{deadline}" th:errorclass="red">
							</div>
						</td>
					</tr>
					<tr>
						<th>„ÉÅ„Çß„ÉÉ„ÇØ</th>
						<td><input type="checkbox" value="Y" th:field="*{done}">ÂÆå‰∫Ü
							<input type="hidden" name="!done" value="N" />
						</td>
					</tr>
				</table>
			</div>
			<!--Êõ¥Êñ∞„ÅÆÂ†¥Âêà„ÄÅÊ∑ª‰ªò„Éï„Ç°„Ç§„É´„ÅÆ‰∏ÄË¶ß„ÇíË°®Á§∫„Åô„Çã9/19  -->
			<div th:if="${session.mode=='update'}">
				<div style="margin-left: 3em;">
					<span th:text="#{text.attachedfiles}"></span>
					<table>
						<tr>
							<th>id</th>
							<th th:text="#{label.filename}"></th>
							<th th:text="#{label.note}"></th>
							<th></th>
						</tr>
						<tr th:each="af:*{attachedFileList}">
							<!--  -->
							<!-- id-->
							<td th:text="${af.id}"></td>
							<!--„Éï„Ç°„Ç§„É´Âêç-->
							<td th:if="${af.openInNewTab}"><a th:href="@{/todo/af/download/__${af.id}__}"
									th:text="${af.fileName}" target="_blank" rel="noopener noreferrer"></a></td>
							<!-- download„Åô„Çã„Éï„Ç°„Ç§„É´-->
							<td th:unless="${af.openInNewTab}">
								<!--  --> <a th:href="@{/todo/af/download/__${af.id}__}" th:text="${af.fileName}"></a>
							</td>

							<!-- „É°„É¢-->
							<td th:text="${af.note}"></td>
							<!--ÂâäÈô§„É™„É≥„ÇØ-->
							<td><a th:href="@{/todo/af/delete(af_id=${af.id},todo_id=${todoData.id})}"
									th:text="#{link.delete}"></a></td>
						</tr>
					</table>
				</div>

			</div>
		</div>
		<!--mode=update„ÅÆÊôÇ„Å´Todo„ÅÆÂÖ®‰ΩìÂâäÈô§„Éú„Çø„É≥„ÇíË°®Á§∫  -->
		<div th:if="${session.mode=='update'}">
			<button type="submit" th:formaction="@{/todo/update}">Êõ¥Êñ∞</button>
			<button type="submit" th:formaction="@{/todo/delete}">ÂâäÈô§</button>
			<button type="submit" th:formaction="@{/todo/cancel}">„Ç≠„É£„É≥„Çª„É´</button>
		</div>
		<!-- „Çø„Çπ„ÇØ‰∏ÄË¶ßË°®Á§∫9/13 -->
		<div th:if="${session.mode=='update'}">
			<hr style="margin-top: 2em; margin-bottom: lem;">
			üî≤ÂêÑ„Çø„Çπ„ÇØ
			<div>
				<table>
					<tr>
						<th>id</th>
						<th th:text="#{label.title}"></th>
						<th th:text="#{label.deadline}"></th>
						<th th:text="#{label.check}"></th>
						<th></th>
						<!-- ÂâäÈô§„É™„É≥„ÇØ„ÅÆ„Åü„ÇÅ„ÅÆÂàó -->
					</tr>
					<!-- ÁôªÈå≤„Åï„Çå„Åü„Çø„Çπ„ÇØ-->
					<tr th:each="task,stat:*{taskList}">
						<!--id  -->
						<td><span th:text="${task.id}"></span> <!-- Êõ¥Êñ∞„ÇíÂèçÊò†„Åô„Çã„Åü„ÇÅ„ÅÆË®òËø∞ -->
							<input type="hidden" th:name="${'taskList['+ stat.index +'].id'}" th:value="${task.id}" />
						</td>
						<!-- title nameÂÄ§„ÅØtaskList[n].title„Å®„Å™„Çã„ÅÆ„Åß„ÄÅstatÂ§âÊï∞„Çí‰ΩøÁî®„Åó„Å¶„ÅÑ„Çã„ÄÇ-->
						<td><input type="text" th:name="${'taskList['+stat.index +'].title'}" size="40"
								th:value="${task.title}">
							<div th:if="${#fields.hasErrors('taskList['+stat.index+'].title')}"
								th:errors="*{taskList[__${stat.index}__].title}" th:errorclass="red"></div>
						</td>
						<!-- ÊúüÈôê -->
						<td><input type="text" th:name="${'taskList['+stat.index +'].deadline'}" size="10"
								th:value="${task.deadline}" placeholder="yyyy-mm-dd">
							<div th:if="${#fields.hasErrors('taskList['+stat.index+'].deadline')}"
								th:errors="*{taskList[__${stat.index}__].deadline}" th:errorclass="red"></div>
						</td>
						<!-- „ÉÅ„Çß„ÉÉ„ÇØ -->
						<td><input type="checkbox" th:name="${'taskList['+stat.index +'].done'}" value="Y"
								th:checked="*{taskList[__${stat.index}__].done=='Y'}" /> <input type="hidden"
								th:name="${'taskList['+stat.index +'].done'}" value="N" /></td>
						<!-- ÂâäÈô§ -->
						<td><a th:href="@{/task/delete(task_id=${task.id},todo_id=*{id})}" th:text="#{link.delete}"></a>
						</td>
					</tr>
					<!-- Êñ∞Ë¶è„Çø„Çπ„ÇØÂÖ•Âäõ -->
					<tr>
						<!--id  -->
						<td></td>
						<!--‰ª∂Âêç  -->
						<td><input type="text" name="newTask.title" size="40" th:value="*{newTask.title}">
							<div th:if="${#fields.hasErrors('newTask.title')}" th:errors="*{newTask.title}"
								th:errorclass="red"></div>
						</td>
						<!--ÊúüÈôê-->
						<td><input type="text" name="newTask.deadline" size="10" th:value="*{newTask.deadline}"
								placeholder="yyyy-mm-dd">
							<div th:if="${#fields.hasErrors('newTask.deadline')}" th:errors="*{newTask.deadline}"
								th:errorclass="red"></div>
						</td>
						<!--„ÉÅ„Çß„ÉÉ„ÇØ -->
						<td><input type="checkbox" name="newTask.done" value="Y" th:checked="*{newTask.done=='Y'}" />
							<input type="hidden" name="!newTask.done" value="N" /></td>
						<!-- ËøΩÂä†„Éú„Çø„É≥-->
						<td style="padding: 0px;">
							<button type="submit" th:formaction="@{/task/create}" th:text="#{button.add}"
								style="margin: 2px; padding: 2px; width: 4em;"></button>
						</td>
					</tr>
				</table>
			</div>
		</div>
		<!--mode=create:ÁôªÈå≤„ÄÅmode=update:ÂâäÈô§„ÅÆ„Éú„Çø„É≥„ÇíË°®Á§∫„ÄÇ-->
		<div th:unless="${session.mode=='update'}">
			<!--‰∏ä„ÅÆË°®Á§∫„Ç≥„Éº„Éâ„ÅÆth:if=session.mode„ÅåfalseÊôÇ„Å´‰ΩúÂãï„Åô„Çã„Çà„ÅÜ„Å´  -->
			<button type="submit" th:formaction="@{/todo/create/do}">ÁôªÈå≤</button>
			<button type="submit" th:formaction="@{/todo/cancel}">„Ç≠„É£„É≥„Çª„É´</button>
		</div>
	</form>
	<!--Ê∑ª‰ªò„Éï„Ç°„Ç§„É´„ÅÆÁôªÈå≤  Êõ¥Êñ∞„ÅÆÂ†¥Âêà„ÄÅÊ∑ª‰ªò„Éï„Ç°„Ç§„É´„ÅÆÁôªÈå≤„Ç®„É™„Ç¢„ÇíË°®Á§∫„Åô„Çã„ÄÇ-->
	<div th:if="${session.mode=='update'}">
		<hr style="margin-top: lem;">
		<span th:text="#{text.regist_attachedfile}"></span>
		<form th:action="@{/todo/af/upload}" enctype="multipart/form-data" method="post">
			<!--„Åì„ÅÆÂΩ¢Âºè„ÅßformË¶ÅÁ¥†„ÅÆ„Éá„Éº„Çø„Çí„Çµ„Éº„Éê„Å∏ÈÄÅ‰ø°„Åô„Çã„Åì„Å®„Åå„Åß„Åç„Çã„ÄÇ„Éï„Ç°„Ç§„É´„ÅåPNG„ÅÆÂ†¥Âêà„ÅØimage/png„Å´Â§â„Çè„Çã„ÄÇ  -->
			<table>
				<tr>
					<!-- „Éï„Ç°„Ç§„É´-->
					<th th:text="#{label.filename}"></th>
					<!-- „É°„É¢-->
					<th th:text="#{label.note}"></th>
				</tr>
				<!-- ÂÖ•ÂäõË°å-->
				<tr>
					<!-- „Éï„Ç°„Ç§„É´-->
					<td><input type="file" name="file_contents" required>
						<!--form„Å´„Éï„Ç°„Ç§„É´„ÇíÈÅ∏Êäû„Åó„Å¶Ê∑ª‰ªò„Åô„Çã„Åì„Å®„Åå„Åß„Åç„Çã„ÄÇÊõ¥Êñ∞ÁîªÈù¢„ÅÆÊôÇ„ÅØ„Åì„ÅÆ„Éï„Ç°„Ç§„É´„ÅåÂÖ•ÂäõÂøÖÈ†à„Åß„ÅÇ„Çã„Å®Ë®≠ÂÆö„ÄÇ-->
					</td>
					<!--„É°„É¢-->
					<td><input type="text" name="note" size="40"></td>
				</tr>
			</table>
			<!-- ÁôªÈå≤„Éú„Çø„É≥-->
			<button type="submit" th:text="#{button.add}"></button>
			<!--Ê∑ª‰ªòÂÖà„ÅÆTodo„ÅÆid-->
			<input type="hidden" name="todo_id" th:value="${todoData.id}">
		</form>

	</div>
</body>

</html>